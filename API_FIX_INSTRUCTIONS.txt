# API FIX FOR MAIN.PY
# Based on working test_api.py pattern

## CHANGE 1: Update .env file
# Old token: LEAKOSINT_API_TOKEN=8280973137:ZZoo67o2
# New token: LEAKOSINT_API_TOKEN=1799933101:9xT1lIZk

## CHANGE 2: In generate_report function (around line 56-67)
# REMOVE this line:
#     response.raise_for_status()

# REPLACE lines 56-67 with:
    try:
        logger.info(f"Searching for: {query}")
        response = requests.post(LEAKOSINT_API_URL, json=data, timeout=30)
        
        try:
            json_response = response.json()
        except json.JSONDecodeError:
            logger.error("Failed to decode JSON response")
            logger.error(f"Raw response: {response.text[:500]}")
            return None
        
        logger.info(f"API Response: {json_response}")
        
        # Check for API errors (including 502 backend errors)
        if "error" in json_response:
            error_code = json_response.get("error")
            logger.error(f"API Error: {error_code}")
            return None
        
        if "Error code" in json_response:
            logger.error(f"API Error Code: {json_response['Error code']}")
            return None

# That's it! These are the only changes needed to match the working test_api.py pattern.
